<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" vocab="http://ogp.me/ns" lang="en">
<head>
<link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<!-- Enable responsiveness on mobile devices--><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<meta name="description" content="A hack to fetch content for unread Pinboard bookmarks.">
<meta name="author" content="punchagan">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/assets/css/all.css" rel="stylesheet" type="text/css">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml">
<link rel="stylesheet" type="text/css" href="/assets/css/tipuesearch.css">
<title>
      Elfeed hook to fetch full content · Noetic Nought
  </title>
</head>
<body class="layout-reverse theme-base-0d">

<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" checked><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Noetic Nought — For an idle mind is the devil's workshop. </p>
  </div>

  <nav class="sidebar-nav"><!-- The code below dynamically generates a sidebar nav of pages with --><!-- `layout: page` in the front-matter. See readme for usage. --><a class="sidebar-nav-item" href="/index.html"><i class="fa fa-home on fa-lg"></i> Home</a>
      <a class="sidebar-nav-item" href="/posts/index.html"><i class="fa fa-pencil on fa-lg"></i> Blog</a>
      <a class="sidebar-nav-item" href="/archive.html"><i class="fa fa-archive on fa-lg"></i> Archives</a>
      <a class="sidebar-nav-item" href="/tags/index.html"><i class="fa fa-tags on fa-lg"></i> Tags</a>
      <a class="sidebar-nav-item" href="/tags/cat_recursecenter-checkins.html"><i class="fa fa-magic on fa-lg"></i> Recurse Center Logs</a>
      <a class="sidebar-nav-item" href="/tags/cat_bookmarks.html"><i class="fa fa-bookmark on fa-lg"></i> Bookmarks</a>
      <a class="sidebar-nav-item" href="/quotes.html"><i class="fa fa-quote-right on fa-lg"></i> Quotes</a>
      <a class="sidebar-nav-item" href="/reading-list.html"><i class="fa fa-book on fa-lg"></i> Reading List</a>
      <a class="sidebar-nav-item" href="/rss.xml"><i class="fa fa-rss on fa-lg"></i> RSS</a>
      <a class="sidebar-nav-item" href="https://github.com/punchagan"><i class="fa fa-github on fa-lg"></i> GitHub</a>
      <a class="sidebar-nav-item" href="https://twitter.com/punchagan"><i class="fa fa-twitter on fa-lg"></i> Twitter</a>

  </nav><div class="sidebar-item">
    <p>
      
<span class="navbar-form pull-left">
<input type="text" class="sidebar-nav-item" id="tipue_search_input" placeholder="Search this site"></span>
</p>
<div id="tipue_search_content"></div>

    
  </div>

  <div class="sidebar-item">
      <i class="fa fa-creative-commons fa-fw"></i>  2015
<a href="mailto:punchagan%5B@T%5Dmuse-amuse.in">punchagan</a> -
<a href="http://getnikola.com">Nikola</a> powered -

<a rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">
Creative Commons Attribution 3.0 Unported License</a>
 -
<a href="http://themes.getnikola.com/#lanyon">lanyon</a> theme
  </div>

</div>
    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Noetic Nought</a>
            <small>For an idle mind is the devil's workshop.</small>
          </h3>
        </div>
      </div>

      <div class="container content">
<article class="post post-text h-entry hentry postpage" itemscope="itemscope"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="/posts/elfeed-hook-to-fetch-full-content.html" class="u-url">Elfeed hook to fetch full content</a></h1>

            <span class="post-date">19 Dec 2015</span>
        </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>
I have started to use <a href="http://pinboard.in">Pinboard</a>'s <code>unread</code> tag as my to-read list.  It has a
bookmark-let that works pretty well for adding stuff into my "to-read" list.  I
then catch up on this list using <code>elfeed</code> and subscribing to the unread items'
RSS feed.  The work-flow is pretty nice for adding stuff into the list, and
finding items on the list. But, when it comes to the actual reading part, the
entries in the feed don't have the actual content I want to read, and I end up
opening the links in a browser.
</p>

<p>
Inspired by a <a href="https://github.com/sursh/blaggregator/pull/80#issuecomment-165849126">comment from FiloSottile</a>, I realized it should be pretty easy to
setup a hook that fetches the actual content to make my reading work-flow
smoother. I wrote a <a href="https://github.com/punchagan/dot-files/blob/master/bin/get_article.py">small script</a>, using <a href="https://github.com/buriy/python-readability">python-readability</a>, to fetch the page
content, given a URL. This script is then hooked onto <code>elfeed-new-entry-hook</code>,
to fetch content of for new entries as they are fetched.  All the old entries
can be easily fixed with a single call to <code>elfeed-apply-hooks-now</code>.
</p>

<div class="highlight"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">pc/get-url-content</span> <span class="p">(</span><span class="nv">url</span><span class="p">)</span>
  <span class="s">"Fetches the content for a url."</span>
  <span class="p">(</span><span class="nv">shell-command-to-string</span> <span class="p">(</span><span class="nb">format</span> <span class="s">"~/bin/get_article.py %s"</span> <span class="nv">url</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">pc/get-entry-content</span> <span class="p">(</span><span class="nv">entry</span><span class="p">)</span>
  <span class="s">"Fetches content for pinboard entries that are not tweets."</span>
  <span class="p">(</span><span class="nv">interactive</span>
   <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">entry</span> <span class="nv">elfeed-show-entry</span><span class="p">))</span>
     <span class="p">(</span><span class="nb">list</span> <span class="nv">entry</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">url</span> <span class="p">(</span><span class="nv">elfeed-entry-link</span> <span class="nv">entry</span><span class="p">))</span>
	<span class="p">(</span><span class="nv">feed-id</span> <span class="p">(</span><span class="nv">elfeed-deref</span> <span class="p">(</span><span class="nv">elfeed-entry-feed-id</span> <span class="nv">entry</span><span class="p">)))</span>
	<span class="p">(</span><span class="nv">content</span> <span class="p">(</span><span class="nv">elfeed-deref</span> <span class="p">(</span><span class="nv">elfeed-entry-content</span> <span class="nv">entry</span><span class="p">))))</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nb">and</span> <span class="p">(</span><span class="nv">s-matches?</span> <span class="s">"feeds.pinboard.in/"</span> <span class="nv">feed-id</span><span class="p">)</span>
	       <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nv">s-matches?</span> <span class="s">"twitter.com/\\|pdf$\\|png$\\|jpg$"</span> <span class="nv">url</span><span class="p">))</span>
	       <span class="p">(</span><span class="nb">string-equal</span> <span class="s">""</span> <span class="nv">content</span><span class="p">))</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">content</span> <span class="p">(</span><span class="nv">pc/get-url-content</span> <span class="nv">url</span><span class="p">))</span>
      <span class="p">(</span><span class="nb">setf</span> <span class="p">(</span><span class="nv">elfeed-entry-content</span> <span class="nv">entry</span><span class="p">)</span> <span class="p">(</span><span class="nv">elfeed-ref</span> <span class="nv">content</span><span class="p">)))))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'elfeed-new-entry-hook</span> <span class="nf">#'</span><span class="nv">pc/get-entry-content</span><span class="p">)</span>
</pre></div>
    </div>
    <aside class="postpromonav"><nav><div class="pagination">
            <span class="pagination-item older">
                <a href="/posts/say-howdy-with-emacs.html" rel="prev" title="Say Howdy with Emacs!">Previous post</a>
            </span>
        </div>

    </nav></aside><div style="margin: auto; text-decoration: none; text-align: center;">
            <a rel="show-comments" onclick="toggleComments(this)" title="Show comments">Show comments</a>
        </div>
        <script>
         function toggleComments(target) {
             target.remove();
             var comments = document.querySelector('.comments');
             comments.style.display = 'block';
         };
        </script><section class="comments" style="display: none;"><h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="rusticreverie",
            disqus_url="https://punchagan.muse-amuse.in/posts/elfeed-hook-to-fetch-full-content.html",
        disqus_title="Elfeed hook to fetch full content",
        disqus_identifier="cache/posts/elfeed-hook-to-fetch-full-content.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="rusticreverie";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');

          // Uncheck checkbox by default on non-wide screens.
          if (window.innerWidth < 1300) {
              checkbox.checked = false;
          }

          // FIXME: The checkbox should have a cookie!
          // http://www.quirksmode.org/js/cookies.html

      })(document);
    </script><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21111013-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fuse.js/1.0.0/fuse.min.js"></script><script type="text/javascript" src="/assets/js/tipuesearch_set.js"></script><script type="text/javascript" src="/assets/js/tipuesearch.min.js"></script><script type="text/javascript">
$(document).ready(function() {
    $('#tipue_search_input').tipuesearch({
        'mode': 'json',
        'contentLocation': '/assets/js/tipuesearch_content.json',
        'showUrl': false
    });
});
</script>
</body>
</html>
